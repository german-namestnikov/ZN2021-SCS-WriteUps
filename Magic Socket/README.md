# Magic Socket

## About

Данный таск является логическим продолжением задания Magic Lamp. Но теперь атакующий должен был самостоятельно найти устройство, которое можно было бы выключить и получить флаг.

## Description

> Important! You will need initial access to Johan lab machine to solve this task! 
>
> Well, you hacked IOT-lab. Impressive! There're some smart socket in the office. Could you use your power to turn off the server station?
>
> Internal address: smart-sock.vmd.inc:40240

## Solution

Логика взаимодействия клиент-сервер остается прежней, но в данным задании первая сложность заключалась в том, что для начала надо найти жертву, поскольку ни количество, ни другие данные о работающих устройствах не были указаны.  

Для этого используем скрипт, который по очереди пытается выключить 10 устройств по очереди:  
![![search.png](/Magic%20Socket/search.png, Magic Socket")](/Magic%20Socket/search.png)  

При переборе мы видим, что одно из устройств дало нестандартный ответ, содержащий фразу Device Locked.  
Значит, одна из команд должна работать на разблокировку. Снова делаем небольшой перебор всех возможных команд. 
По предыдущему заданию нам известно несколько возможных пар команда-состояние:
000 - выключено
001 - включено
0N1 - смена цвета, где N означает цвет.

Предположим, что команда на блокировку/разблокировку устройства должна выглядеть как 1XY, и составим небольшой пул возможных вариантов: 
100, 101, 110, 111 и т.д. 

![![brute_pin.png](/Magic%20Socket/brute_pin.png, Brute Pin Cmd")](/Magic%20Socket/brute_pin.png)  

Bingo! Как мы и предположили, команда 100 отвечает за разблокировку устройства. И вот мы получили PIN, который отвечает за разблокировку устройства. Его надо отправить следующим сообщением, чтобы устройство было разблокировано.  

Собираем наш эксплоит, который:
1) Получает counter для 7 устройства;
2) Отправляет команду 100;
3) Получает PIN и сразу отправляет его в поле команды;
4) Отправляет команду на выключение;
5) Получает флаг ^_^

![![flag.png](/Magic%20Socket/flag.png, Get flag")](/Magic%20Socket/flag.png)  

Flag: <code> SCS_ZN2021{Unl0ck_sh0uld_b3_phys1cal1} </code>
